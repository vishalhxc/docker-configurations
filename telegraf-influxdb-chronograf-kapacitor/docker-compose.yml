version: '3.7'
services: 
    influxdb:
        image: influxdb:latest
        container_name: influxdb-tg
        network_mode: tg
        ports: 
            - 8086:8086
        volumes: 
            - ./data/influxdb:/var/lib/influxdb

    telegraf:
        image: telegraf:latest
        container_name: telegraf-tg
        network_mode: tg
        depends_on: 
            - influxdb
        ports: 
            - 8125:8125/udp
        volumes: 
            - ./telegraf.conf:/etc/telegraf/telegraf.conf:ro

    chronograf:
        image: chronograf:latest
        container_name: chronograf-tg
        network_mode: tg
        depends_on: 
            - influxdb
            - telegraf
        environment: 
            INFLUXDB_URL: http://influxdb-tg:8086
            KAPACITOR_URL: http://kapacitor-tg:9092
        ports: 
            - 8888:8888
        links:
            - influxdb
            - kapacitor
    
    kapacitor:
        image: kapacitor:latest
        container_name: kapacitor-tg
        network_mode: tg
        depends_on: 
            - influxdb
            - telegraf
            - chronograf
        environment: 
            KAPACITOR_HOSTNAME: kapacitor
            KAPACITOR_INFLUXDB_0_URLS_0: http://influxdb-tg:8086
        links: 
            - influxdb
        ports: 
            - 9092:9092
